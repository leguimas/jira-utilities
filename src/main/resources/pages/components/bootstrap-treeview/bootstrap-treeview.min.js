(function(e,t,n,r){"use strict";var i="treeview";var s=function(t,n){this.$element=e(t);this._element=t;this._elementId=this._element.id;this._styleId=this._elementId+"-style";this.tree=[];this.nodes=[];this.selectedNode={};this._init(n)};s.defaults={injectStyle:true,levels:2,expandIcon:"glyphicon glyphicon-plus",collapseIcon:"glyphicon glyphicon-minus",emptyIcon:"glyphicon",nodeIcon:"glyphicon glyphicon-stop",color:r,backColor:r,borderColor:r,onhoverColor:"#F5F5F5",selectedColor:"#FFFFFF",selectedBackColor:"#428bca",enableLinks:false,highlightSelected:true,showBorder:true,showTags:false,onNodeSelected:r};s.prototype={remove:function(){this._destroy();e.removeData(this,"plugin_"+i);e("#"+this._styleId).remove()},_destroy:function(){if(this.initialized){this.$wrapper.remove();this.$wrapper=null;this._unsubscribeEvents()}this.initialized=false},_init:function(t){if(t.data){if(typeof t.data==="string"){t.data=e.parseJSON(t.data)}this.tree=e.extend(true,[],t.data);delete t.data}this.options=e.extend({},s.defaults,t);this._setInitialLevels(this.tree,0);this._destroy();this._subscribeEvents();this._render()},_unsubscribeEvents:function(){this.$element.off("click")},_subscribeEvents:function(){this._unsubscribeEvents();this.$element.on("click",e.proxy(this._clickHandler,this));if(typeof this.options.onNodeSelected==="function"){this.$element.on("nodeSelected",this.options.onNodeSelected)}},_clickHandler:function(t){if(!this.options.enableLinks){t.preventDefault()}var n=e(t.target),r=n.attr("class")?n.attr("class").split(" "):[],i=this._findNode(n);if(r.indexOf("click-expand")!=-1||r.indexOf("click-collapse")!=-1){this._toggleNodes(i);this._render()}else if(i){if(this._isSelectable(i)){this._setSelectedNode(i)}else{this._toggleNodes(i);this._render()}}},_findNode:function(e){var t=e.closest("li.list-group-item").attr("data-nodeid"),n=this.nodes[t];if(!n){console.log("Error: node does not exist")}return n},_triggerNodeSelectedEvent:function(t){this.$element.trigger("nodeSelected",[e.extend(true,{},t)])},_setSelectedNode:function(e){if(!e){return}if(e===this.selectedNode){this.selectedNode={}}else{this._triggerNodeSelectedEvent(this.selectedNode=e)}this._render()},_setInitialLevels:function(t,n){if(!t){return}n+=1;var i=this;e.each(t,function(t,s){if(n>=i.options.levels){i._toggleNodes(s)}var o=s.nodes?s.nodes:s._nodes?s._nodes:r;if(o){return i._setInitialLevels(o,n)}})},_toggleNodes:function(e){if(!e.nodes&&!e._nodes){return}if(e.nodes){e._nodes=e.nodes;delete e.nodes}else{e.nodes=e._nodes;delete e._nodes}},_isSelectable:function(e){return e.selectable!==false},_render:function(){var t=this;if(!t.initialized){t.$element.addClass(i);t.$wrapper=e(t._template.list);t._injectStyle();t.initialized=true}t.$element.empty().append(t.$wrapper.empty());t.nodes=[];t._buildTree(t.tree,0)},_buildTree:function(t,n){if(!t){return}n+=1;var r=this;e.each(t,function(i,s){s.nodeId=r.nodes.length;r.nodes.push(s);var o=e(r._template.item).addClass("node-"+r._elementId).addClass(s===r.selectedNode?"node-selected":"").attr("data-nodeid",s.nodeId).attr("style",r._buildStyleOverride(s));for(var u=0;u<n-1;u++){o.append(r._template.indent)}if(s._nodes){o.append(e(r._template.expandCollapseIcon).addClass("click-expand").addClass(r.options.expandIcon))}else if(s.nodes){o.append(e(r._template.expandCollapseIcon).addClass("click-collapse").addClass(r.options.collapseIcon))}else{o.append(e(r._template.expandCollapseIcon).addClass(r.options.emptyIcon))}o.append(e(r._template.icon).addClass(s.icon?s.icon:r.options.nodeIcon));if(r.options.enableLinks){o.append(e(r._template.link).attr("href",s.href).append(s.text))}else{o.append(s.text)}if(r.options.showTags&&s.tags){e.each(s.tags,function(n,i){o.append(e(r._template.badge).append(i))})}r.$wrapper.append(o);if(s.nodes){return r._buildTree(s.nodes,n)}})},_buildStyleOverride:function(e){var t="";if(this.options.highlightSelected&&e===this.selectedNode){t+="color:"+this.options.selectedColor+";"}else if(e.color){t+="color:"+e.color+";"}if(this.options.highlightSelected&&e===this.selectedNode){t+="background-color:"+this.options.selectedBackColor+";"}else if(e.backColor){t+="background-color:"+e.backColor+";"}return t},_injectStyle:function(){if(this.options.injectStyle&&!n.getElementById(this._styleId)){e('<style type="text/css" id="'+this._styleId+'"> '+this._buildStyle()+" </style>").appendTo("head")}},_buildStyle:function(){var e=".node-"+this._elementId+"{";if(this.options.color){e+="color:"+this.options.color+";"}if(this.options.backColor){e+="background-color:"+this.options.backColor+";"}if(!this.options.showBorder){e+="border:none;"}else if(this.options.borderColor){e+="border:1px solid "+this.options.borderColor+";"}e+="}";if(this.options.onhoverColor){e+=".node-"+this._elementId+":hover{"+"background-color:"+this.options.onhoverColor+";"+"}"}return this._css+e},_template:{list:'<ul class="list-group"></ul>',item:'<li class="list-group-item"></li>',indent:'<span class="indent"></span>',expandCollapseIcon:'<span class="expand-collapse"></span>',icon:'<span class="icon"></span>',link:'<a href="#" style="color:inherit;"></a>',badge:'<span class="badge"></span>'},_css:".list-group-item{cursor:pointer;}span.indent{margin-left:10px;margin-right:10px}span.expand-collapse{width:1rem;height:1rem}span.icon{margin-left:10px;margin-right:5px}"};var o=function(e){if(t.console){t.console.error(e)}};e.fn[i]=function(t,n){return this.each(function(){var r=e.data(this,"plugin_"+i);if(typeof t==="string"){if(!r){o("Not initialized, can not call method : "+t)}else if(!e.isFunction(r[t])||t.charAt(0)==="_"){o("No such method : "+t)}else{if(typeof n==="string"){n=[n]}r[t].apply(r,n)}}else{if(!r){e.data(this,"plugin_"+i,new s(this,e.extend(true,{},t)))}else{r._init(t)}}})}})(jQuery,window,document)
